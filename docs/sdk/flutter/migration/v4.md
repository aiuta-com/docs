# Migration to the SDK version 4

This document provides an overview of the changes introduced in SDK version 4. It includes:

- updates in the management of user data — completion states, consents, and historical records;
- image ownership and changes the backend processes for deleting images upon user requests, which now take into account the ownership of the images;
- the general changes made to the configuration and features.

??? question "Why does version __4__ come after version __1__?"
    The Aiuta Flutter SDK has transitioned directly from version 1 to version 4, skipping versions 2 and 3. This decision aligns with our new policy to ensure that all mobile platforms — Android, iOS, and Flutter — are delivered simultaneously with the same functionality and based on a unified scheme. By synchronizing the version numbers across all platforms, we aim to provide a consistent and cohesive experience for developers working with our SDKs. The choice of version 4 as the next release was determined by the least common version number across Android, iOS, and Flutter, ensuring that all platforms are now aligned under the same versioning system. This unified approach simplifies the development process and ensures feature parity across different mobile environments.

## Latest publlished version

```yaml
{{ latest_flutter() }}
```

## Platform & Build Requirements

<div class="grid cards" markdown>

-   :fontawesome-brands-android:{ .lg } __Android__

    ---

    {% include-markdown "sdk/templates/android/requirements-flutter.md" %}

-   :fontawesome-brands-apple:{ .lg } __iOS__

    ---

    ```yaml
    iOS: 12+
    swift: 5.10
    Xcode: 15.3+
    ```

</div>

## Configuration

SDK v4 introduces a new, unified way to configure the SDK using the AiutaConfiguration class. This approach provides a more flexible and modular configuration scheme for features and UI customization.

!!! doc "Please see"
    - New common [Configuration Scheme](/sdk/developer/configuration/index.md)
    - How to [apply this scheme in Flutter](/sdk/flutter/configuration.md)

## Data management

### Onboarding completion state

In this version, onboarding and the consent pages are not so tightly coupled. There are several configuration options when the SDK cannot determine whether to not show onboarding again based on the consent status only. Therefore, a `dataProvider` has been added to manage the onboarding state.

!!! doc "Learn how it works and how to implement it:"
    - [Onboarding page Data Management](/sdk/about/pages/onboarding.md#data-management)
    - [`OnboardingFeature` scheme](/sdk/developer/configuration/features/onboarding.md) 

??? question "How to determine this status for current users?"
    For existing users, you can set `isOnboardingCompleted` based on whether main `consent` was previously obtained, as consent was a mandatory final slide of the onboarding process in the first version.

### User consents

This version significantly expands the possibilities of how, when, and what to ask the user for consent. This required adding data models for consents and operating them with identifiers.

!!! doc "For full context, see"

    - [`Consent` model sheme](/sdk/developer/configuration/features/consent.md#consent)
    - [One of `Standalone` consent configuration](/sdk/developer/configuration/features/consent.md) and its `dataProviders`
    - [Standalone consent page Data Management](/sdk/about/pages/consent.md#data-management) explaining how does the SDK decide when to request consent

??? question "How to map existing data?"
    If you did not have internal identifiers for consents and only stored the status, create one, for example, `main` and provide it in the list of received consents for the SDK depending on the state flag you stored earlier.
    
    If you already have internal identifiers, simply provide them to the SDK.

### Users' History Images

Image data models have two key updates:

- Uploaded images and generated images are now distinguished by class - generated images must store their associated product IDs.
- Both data models now have an owner type - this is to distinguish users' personal images from model images provided by Aiuta.

    ??? warning "Do not delete `aiuta` owned image files"
        You should only link/unlink those images in the user's history.


!!! doc "To understand this change, see [input image](/sdk/developer/configuration/features/image-picker.md#input-image) and [generated image](/sdk/developer/configuration/features/try-on.md#generated-image) schemes and its `OwnerType`s"

??? question "How to determine product identifiers for old images?"
    If you have not previously saved the connections between products and generated images, this data cannot be restored. But don't worry, just pass an empty list to the SDK, and this will only result in the absence of accompanying text/links when the user wants to share a previously generated image.

## Resources

Resources are now grouped by topic and feature. We have tried to keep the names the same, but in some cases localization and a few isolated instances have been renamed to better reflect their meaning.

!!! warning "Built-in resources"
    Please note that the [image picker](/sdk/about/pages/image-picker.md) resources have been changed and best results slide images are no longer included in the standard set as this slide was deprecated.


- [Icons](/sdk/about/resources/icons.md)
- [Images](/sdk/about/resources/images.md)
- [Colors](/sdk/about/resources/colors.md)
- [Shapes](/sdk/about/resources/shapes.md)
- [Typography](/sdk/about/resources/typography.md)
- [Localization](/sdk/about/resources/localization.md)

## Analytics

Analytics has been expanded and supplemented. Types have been simplified. 

!!! doc "Please refer to the complete list of [analytics events](/sdk/about/analytics/analytics.md)"
